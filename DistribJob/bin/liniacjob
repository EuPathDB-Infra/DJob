#!@perl@

use strict;

#work around liniac bug that loses stdout
open(STDOUT, ">&STDERR")     || die "Can't dup stdout";

my $nodes = join(' ', &getNodes());

my $cmd = "distribjob $ARGV[0] $nodes";

print "Liniac user id: $ENV{USER}\n";

system($cmd);

sub getNodes {
  my $c = "cmgetnodes $ENV{JOBID}";
  my $nodelist = `$c`;
  my $status = $? >> 8;
  die "Failed with status $status running '$c'\n" if $status;
  my %tmp;

  foreach my $n (split(/\s+/, $nodelist)){
    $tmp{$n} = 1;
  }

  return keys %tmp;
}
